# opensearch-values.yaml
# OpenSearch 마스터 노드 3개, 데이터 노드 3개 구성 (최소 리소스)

clusterName: "opensearch-cluster"
nodeGroup: "master"

# 마스터 노드 설정
masterService: "opensearch-cluster-master"
roles:
  - master

replicas: 3

# 최소 리소스 설정
resources:
  requests:
    cpu: "100m"
    memory: "512Mi"
  limits:
    cpu: "400m"
    memory: "1Gi"

# JVM 힙 메모리 설정 (메모리의 50% 정도)
opensearchJavaOpts: "-Xmx512m -Xms512m"

# 클러스터 설정
config:
  opensearch.yml: |
    cluster.name: opensearch-cluster

    # 네트워크 설정
    network.host: 0.0.0.0

    # 디스커버리 설정
    discovery.seed_hosts: opensearch-cluster-master-headless
    cluster.initial_master_nodes:
      - opensearch-cluster-master-0
      - opensearch-cluster-master-1
      - opensearch-cluster-master-2

    # 보안 설정 (개발 환경용 - 프로덕션에서는 활성화 필요)
    plugins.security.disabled: true

    # Performance Analyzer 비활성화 (에러 방지)
    plugins.sql.enabled: false

    # SQL 플러그인 설정 (경고 제거)
    plugins.query.datasources.encryption.masterkey: "changeme"

    # 성능 최적화
    bootstrap.memory_lock: false

    # Dangling indices 자동 import 활성화
    gateway.auto_import_dangling_indices: true

    # 로그 레벨 설정
    logger.level: WARN

plugins:
  enabled: true
  installList:
    - repository-s3

# 퍼시스턴트 볼륨 설정 (최소 용량)
persistence:
  enabled: true
  size: 5Gi
  storageClass: "" # 기본 스토리지 클래스 사용

# 서비스 설정
service:
  type: NodePort
  port: 9200
  nodePort: 30920

# 노드 선택기 (선택사항)
nodeSelector: {}
tolerations: []
affinity: {}

# 보안 컨텍스트
securityContext:
  fsGroup: 1000
  runAsUser: 1000
  capabilities:
    add:
      - IPC_LOCK
      - SYS_RESOURCE

# Pod 보안 컨텍스트
podSecurityContext:
  fsGroup: 1000
  runAsUser: 1000

# OpenSearch 대시보드 비활성화 (별도 설치)
dashboards:
  enabled: false
